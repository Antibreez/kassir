{"version":3,"file":"main.js","sources":["source/js/modules/constants.js","source/js/modules/backend.js","source/js/modules/cellLoader.js","source/js/main.js"],"sourcesContent":["const URL = {\n  users: 'https://jsonplaceholder.typicode.com/users',\n  posts: 'https://jsonplaceholder.typicode.com/posts',\n  comments: 'https://jsonplaceholder.typicode.com/comments'\n}\n\nexport {URL};\n","import {URL} from './constants';\n\nconst status = (response) => {\n  if (response.status >= 200 && response.status < 300) {\n    return Promise.resolve(response)\n  } else {\n    return Promise.reject(new Error(response.status))\n  }\n}\n\nconst json = (response) => {\n  return response.json()\n}\n\nconst getUsersData = (onLoad, onPostsLoad, onCommentsLoad, onError) => {\n  fetch(URL.users)\n  .then(status)\n  .then(json)\n  .then((users) => {\n    fetch(URL.posts)\n    .then(status)\n    .then(json)\n    .then((posts) => {\n      fetch(URL.comments)\n      .then(status)\n      .then(json)\n      .then((comments) => {\n        onLoad(users);\n        onPostsLoad(posts);\n        onCommentsLoad(comments);\n      }).catch((error) => {\n        alert('Post\\'s comments loading failed. ' + error);\n        onError();\n      });\n    }).catch((error) => {\n      alert('Users\\'s posts loading failed. ' + error);\n      onError();\n    });\n  }).catch((error) => {\n    alert('Users loading failed. ' + error);\n    onError();\n  });\n}\n\nconst getComments = (id, onSuccess, onError) => {\n  fetch(URL.comments)\n  .then(status)\n  .then(json)\n  .then((data) => {\n    onSuccess(data, id);\n  }).catch((error) => {\n    alert('Comments loading failed. ' + error);\n    onError();\n  });\n}\n\nexport {getUsersData, getComments};\n","const cellLoader = {\n  add: (cell) => {\n    const loader = document.createElement('div');\n    loader.classList.add('loader')\n    loader.textContent = 'Loading...'\n    loader.style.position = 'absolute';\n    loader.style.top = '0';\n    loader.style.left = '0';\n    loader.style.padding = '5px';\n    loader.style.height = '100%';\n    loader.style.width = '100%';\n    loader.style.backgroundColor = '#fff';\n\n    cell.appendChild(loader);\n  },\n  remove: (cell) => {\n    const loader = cell.querySelector('.loader');\n    loader.parentNode.removeChild(loader);\n  }\n}\n\nexport default cellLoader;\n","import {getUsersData, getComments} from \"./modules/backend\";\nimport cellLoader from \"./modules/cellLoader\";\n\nconst usersData = [];\n\nconst onUsersLoad = (data) => {\n  data.forEach((item) => {\n    let user = {};\n    user.id = item.id;\n    user.name = item.name;\n    usersData.push(user);\n  })\n}\n\nconst onPostsLoad = (data) => {\n  data.forEach((item) => {\n    let user = usersData.find((it) => it.id == item.userId);\n    if (!user.posts) {\n      user.posts = [];\n    }\n    const post = {};\n    post.id = item.id;\n    post.title = item.title;\n    user.posts.push(post);\n  })\n}\n\nconst onCommentsLoad = (data) => {\n  data.forEach((item) => {\n    usersData.forEach((userData, idx) => {\n      let post = userData.posts.find((it) => it.id == item.postId)\n\n      if(!post) {\n        return\n      }\n\n      if (!post.comments) {\n        post.comments = 0;\n      }\n      post.comments++;\n    })\n  })\n\n  renderData();\n  removeLoader();\n  addEventListeners();\n}\n\nconst onUsersLoadFail = () => {\n  removeLoader();\n}\n\nconst onCurrentCommentsLoad = (cell) => {\n  return (data, id) => {\n    let comments = 0;\n    data.forEach((item) => {\n      if (item.postId === id) {\n        comments++;\n      }\n    })\n\n    cell.textContent = comments;\n  }\n}\n\nconst onCurrentCommentsLoadFail = (cell) => {\n  return () => {\n    cellLoader.remove(cell);\n  }\n\n}\n\nconst addEventListeners = () => {\n  const rows = document.querySelectorAll('table tr[data-id]');\n\n  rows.forEach((row) => {\n    row.addEventListener('click', (e) => {\n      const target = e.currentTarget;\n      const id = +target.getAttribute('data-id');\n      const cell = target.querySelectorAll('td')[2];\n      cellLoader.add(cell);\n      getComments(id, onCurrentCommentsLoad(cell), onCurrentCommentsLoadFail(cell));\n    })\n  })\n}\n\nconst renderData = () => {\n  const fragment = document.createDocumentFragment();\n  const table = document.createElement('table');\n  const tbody = document.createElement('tbody');\n  const tr = document.createElement('tr');\n  const thName = document.createElement('th');\n  thName.textContent = 'User';\n  const thPost = document.createElement('th');\n  thPost.textContent = 'Post title';\n  const thComments = document.createElement('th');\n  thComments.textContent = 'Comments';\n  tr.appendChild(thName);\n  tr.appendChild(thPost);\n  tr.appendChild(thComments);\n  tbody.appendChild(tr);\n\n  usersData.forEach((data) => {\n    data.posts.forEach((post) => {\n\n      const tr = document.createElement('tr');\n      tr.setAttribute('data-id', post.id);\n      const tdName = document.createElement('td');\n      tdName.textContent = data.name;\n      const tdPost = document.createElement('td');\n      tdPost.textContent = post.title;\n      const tdComments = document.createElement('td');\n      tdComments.textContent = post.comments;\n      tdComments.style.position = 'relative';\n      tr.appendChild(tdName);\n      tr.appendChild(tdPost);\n      tr.appendChild(tdComments);\n      fragment.appendChild(tr);\n    })\n  })\n\n  tbody.appendChild(fragment);\n  table.appendChild(tbody);\n  document.querySelector('body').appendChild(table);\n}\n\nconst removeLoader = () => {\n  document.getElementById('loader').classList.add('hidden');\n}\n\ngetUsersData(onUsersLoad, onPostsLoad, onCommentsLoad, onUsersLoadFail);\n"],"names":[],"mappings":"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"}